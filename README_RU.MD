### Проект X2O
rev 61215 (черновик)

X2O отображает данные XML-файла в документы ODF,OOXML в соответствии с декларациями, размещенными в ячейках таблиц или тексте документа-шаблона.  Для отбора данных используются выражения [xPath 1.0](http://citforum.ru/internet/xpath) .

###1 Декларации
Декларации обеспечивают отбор, группировку и вывод данных XML.

###1.1 Декларации объявления подмножеств
Подмножества служат для отбора и группировки данных. Объявление подмножества может быть размещено в любом месте листа электронной таблицы, документа или презентации. Корректные объявления удаляются из документа при генерации.

объявление ::= **"$"**имяПодмножества**":{"**выражениеXPath**"}"**директивы  
имяПодмножества ::=  \[a-zA-Z\](\w)?  
директивы ::= (**"."**директива)?  

Имена подмножеств начинаются с буквы и могут содержать буквы, цифры и знаки подчеркивания. Переопределение подмножества в пределах области действия не допускается. Подмножества являются переменными XPath типа node-set. Подмножество по-умолчанию:  //*

###1.2 Макроподстановки
Макроподстановки обрабатываются интерпретатором x2o и могут использоваться в выражениях XPath:

макроподстановка ::= **"$"**имяПодмножества**"&"**

Макроподстановка возвращает строку-выражениеXPath из определения подмножества. Рекурсия в макроподстановках не допускается.
 
###1.3 Декларации вывода элементов
Декларации вывода замещаются значениями указанных элементов XML.

декларация вывода ::= **"$"**подмножества**"{"**выражениеXPath**"}"**директивы  
подмножества ::= (имяПодмножества(**"."**имяПодмножества)?)?
```
$a:{//abc}
$b:{/def}
$a.b{/ghi}  =  ${//abc/def/ghi}  =  ${$a/def/ghi}  =  ${$a.b/ghi}  =  ${$a&$b&/ghi}  =  ${$a.b&/ghi}
$a.b{/ghi} != ${//abc$b/ghi}
```

Элементами вывода могут быть узлы, атрибуты. Для узлов выводится их содержимое.
Повторяющейся единицей вывода подмножества является блок: область, включающая декларации вывода его элементов (охватывающая область ячеек таблиц, набор абзацев документа). По-умолчанию производится вставка блоков.

###1.4 Встроенные переменные
  
**null**  
      возвращает «пустой» элемент подмножества.
```
$a{$null} | $a.b{}
$c:{}  определение пустого множества
```
  
**index**  
      возвращает элемент, содержащий текущий индекс выводимого блока, начиная с 1. 
```
$a.b{$index}
```
  
###1.5 Директивы
  
Директивы управляют выводом и интерпретацией данных XML.

директива  ::= имяДирективы(**"{"**параметр**"}"**)
  

####1.5.1 Директивы управления выводом

**onNotExists{remove | retain}**  
 директива определяет действие в случае отсутствия элемента XML:  
 remove - удалить блок, если подмножество не существует;  
 retain - не интерпретировать и оставить без изменения декларации, если подмножество не существует.
```
$a:{//abc}.onNotExists{remove}
```
  
**overprint{n}** (только таблицы)  
  директива включает режим наложения блоков данных для $index <= n, при $index > n возобновляется режим вставки. 
  Если n опущено — режим наложения действует на все подмножество.
```
$a.b{//ghi}.overprint{2} | $a.b{//ghi}.overprint
```
  
####1.5.2 Директивы формата данных XML
Если для ячейки шаблона определен стиль числа или даты, интерпретатор пытается преобразовать содержимое элемента к соответствующему типу с учетом директив формата. 
    
**dates{формат}**  
  директива определяет формат даты для множества или узла XML:  
  формат  ::=  подходящий код формата ODF(**" Locale="**локаль)
```
$a:{//abc}.dates{DD.MM.YYYY} | $a.b{/ghi}.dates{NNNNDD MMMM, YYYY Locale=ru}
```

**numbers{разделители}**  
  директива определяет формат числа для подмножества или элемента XML:  
  первый символ - разделитель целой и дробной части числа;  
  второй символ - разделитель разрядов.
```
$a:{//abc}.numbers{, } | $a.b{/ghi}.numbers{, }
```

